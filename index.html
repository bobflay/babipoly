<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Babipoly ‚Äî Supply Chain Tracker</title>
  <style>
    :root {
      --primary: #1a2332;
      --primary-light: #2c3e50;
      --accent: #3498db;
      --accent-dark: #2980b9;
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
      --light: #f4f6f9;
      --border: #dde3ea;
      --text: #2c3e50;
      --text-muted: #7f8c8d;
      --card: #ffffff;
      --radius: 10px;
      --shadow: 0 2px 12px rgba(0,0,0,0.08);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--light);
      color: var(--text);
      min-height: 100vh;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: #fff;
      padding: 0;
    }
    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 32px 16px;
      flex-wrap: wrap;
      gap: 16px;
    }
    .header-brand {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .brand-icon {
      width: 48px; height: 48px;
      background: var(--accent);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }
    .brand-text h1 { font-size: 22px; font-weight: 700; letter-spacing: 0.5px; }
    .brand-text p  { font-size: 12px; opacity: 0.7; margin-top: 2px; }

    .header-stats {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
    }
    .stat-pill {
      text-align: center;
    }
    .stat-pill .val { font-size: 26px; font-weight: 700; color: #fff; line-height: 1; }
    .stat-pill .lbl { font-size: 11px; opacity: 0.65; margin-top: 2px; text-transform: uppercase; letter-spacing: 0.5px; }

    .header-progress {
      padding: 12px 32px 0;
      background: rgba(0,0,0,0.15);
    }
    .progress-bar-row {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 0;
    }
    .progress-label { font-size: 13px; opacity: 0.8; white-space: nowrap; }
    .progress-track {
      flex: 1;
      height: 10px;
      background: rgba(255,255,255,0.2);
      border-radius: 99px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #27ae60, #2ecc71);
      border-radius: 99px;
      transition: width 0.5s ease;
    }
    .progress-pct { font-size: 14px; font-weight: 700; min-width: 40px; text-align: right; }

    /* ‚îÄ‚îÄ NAV TABS ‚îÄ‚îÄ */
    nav.tabs {
      background: var(--primary-light);
      display: flex;
      padding: 0 32px;
      gap: 4px;
      border-bottom: 3px solid var(--primary);
    }
    nav.tabs button {
      background: transparent;
      border: none;
      color: rgba(255,255,255,0.6);
      font-size: 13px;
      font-weight: 600;
      padding: 13px 18px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      margin-bottom: -3px;
      transition: all 0.2s;
      white-space: nowrap;
    }
    nav.tabs button:hover  { color: rgba(255,255,255,0.9); }
    nav.tabs button.active { color: #fff; border-bottom-color: var(--accent); }

    /* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
    main { max-width: 1200px; margin: 0 auto; padding: 28px 24px; }
    .tab-section { display: none; }
    .tab-section.active { display: block; }

    /* ‚îÄ‚îÄ SECTION HEADERS ‚îÄ‚îÄ */
    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .section-title::after {
      content: '';
      flex: 1;
      height: 2px;
      background: var(--border);
      border-radius: 1px;
    }

    /* ‚îÄ‚îÄ OVERVIEW CARDS GRID ‚îÄ‚îÄ */
    .overview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }
    .comp-card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      border-left: 4px solid var(--border);
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
    }
    .comp-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.12); }
    .comp-card.status-todo    { border-left-color: var(--border); }
    .comp-card.status-active  { border-left-color: var(--warning); }
    .comp-card.status-done    { border-left-color: var(--success); }

    .comp-card-header {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 14px;
    }
    .comp-icon {
      font-size: 28px;
      line-height: 1;
      flex-shrink: 0;
    }
    .comp-card-header-text h3 { font-size: 15px; font-weight: 700; }
    .comp-card-header-text p  { font-size: 11px; color: var(--text-muted); margin-top: 2px; }

    .comp-card-progress { margin-bottom: 10px; }
    .mini-track {
      height: 7px;
      background: #eef0f3;
      border-radius: 99px;
      overflow: hidden;
      margin-top: 5px;
    }
    .mini-fill {
      height: 100%;
      border-radius: 99px;
      background: linear-gradient(90deg, var(--accent), #27ae60);
      transition: width 0.4s ease;
    }
    .comp-card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-muted);
    }
    .stage-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 99px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .badge-todo    { background: #eef0f3; color: #7f8c8d; }
    .badge-active  { background: #fef9e7; color: #f39c12; }
    .badge-done    { background: #eafaf1; color: #27ae60; }

    /* ‚îÄ‚îÄ SUMMARY STATS ROW ‚îÄ‚îÄ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 28px;
    }
    .stat-card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      text-align: center;
    }
    .stat-card .num {
      font-size: 36px;
      font-weight: 800;
      line-height: 1;
      margin-bottom: 6px;
    }
    .stat-card .txt { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-card.s-total   .num { color: var(--primary); }
    .stat-card.s-active  .num { color: var(--warning); }
    .stat-card.s-done    .num { color: var(--success); }
    .stat-card.s-tasks   .num { color: var(--accent); }

    /* ‚îÄ‚îÄ COMPONENT ACCORDION ‚îÄ‚îÄ */
    .comp-accordion { display: flex; flex-direction: column; gap: 12px; }

    .acc-item {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .acc-header {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 18px 20px;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s;
    }
    .acc-header:hover { background: #f9fafb; }

    .acc-icon { font-size: 24px; flex-shrink: 0; }
    .acc-title { flex: 1; }
    .acc-title h3 { font-size: 15px; font-weight: 700; }
    .acc-title p  { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

    .acc-meta {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .acc-pct { font-size: 20px; font-weight: 800; color: var(--primary); min-width: 50px; text-align: right; }
    .acc-chevron {
      font-size: 18px;
      color: var(--text-muted);
      transition: transform 0.2s;
      line-height: 1;
    }
    .acc-item.open .acc-chevron { transform: rotate(180deg); }

    .acc-progress-bar {
      height: 4px;
      background: #eef0f3;
    }
    .acc-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--success));
      transition: width 0.4s;
    }

    .acc-body {
      display: none;
      padding: 0 20px 20px;
    }
    .acc-item.open .acc-body { display: block; }

    /* ‚îÄ‚îÄ STAGE PIPELINE ‚îÄ‚îÄ */
    .stage-pipeline {
      display: flex;
      gap: 0;
      margin: 20px 0;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    .stage-step {
      flex: 1;
      min-width: 110px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .stage-step::before {
      content: '';
      position: absolute;
      top: 18px;
      left: 50%;
      right: -50%;
      height: 2px;
      background: var(--border);
      z-index: 0;
    }
    .stage-step:last-child::before { display: none; }
    .stage-step.done::before { background: var(--success); }
    .stage-step.active::before { background: linear-gradient(90deg, var(--warning), var(--border)); }

    .stage-dot {
      width: 36px; height: 36px;
      border-radius: 50%;
      border: 3px solid var(--border);
      background: #fff;
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
      z-index: 1;
      flex-shrink: 0;
      transition: all 0.2s;
    }
    .stage-step.done   .stage-dot { border-color: var(--success); background: var(--success); color: #fff; }
    .stage-step.active .stage-dot { border-color: var(--warning); background: var(--warning); color: #fff; box-shadow: 0 0 0 4px rgba(243,156,18,0.2); }

    .stage-label {
      font-size: 10px;
      font-weight: 600;
      text-align: center;
      margin-top: 8px;
      color: var(--text-muted);
      line-height: 1.3;
    }
    .stage-step.done   .stage-label { color: var(--success); }
    .stage-step.active .stage-label { color: var(--warning); }

    /* ‚îÄ‚îÄ TASKS SECTIONS ‚îÄ‚îÄ */
    .tasks-grid { display: flex; flex-direction: column; gap: 10px; margin-top: 16px; }

    .task-stage-block {
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }
    .task-stage-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 11px 14px;
      background: #f8fafc;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s;
    }
    .task-stage-header:hover { background: #f0f4f8; }
    .task-stage-dot {
      width: 10px; height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .task-stage-header h4 { flex: 1; font-size: 13px; font-weight: 700; }
    .task-stage-count { font-size: 11px; color: var(--text-muted); }
    .task-stage-chevron { font-size: 12px; color: var(--text-muted); transition: transform 0.2s; }
    .task-stage-block.open .task-stage-chevron { transform: rotate(180deg); }

    .task-list { display: none; padding: 8px 14px 14px; }
    .task-stage-block.open .task-list { display: block; }

    .task-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 7px 0;
      border-bottom: 1px solid #f0f4f8;
    }
    .task-item:last-child { border-bottom: none; }

    .task-item input[type="checkbox"] {
      width: 17px; height: 17px;
      margin-top: 1px;
      cursor: pointer;
      accent-color: var(--success);
      flex-shrink: 0;
    }
    .task-item label {
      font-size: 13px;
      cursor: pointer;
      line-height: 1.4;
      color: var(--text);
    }
    .task-item.checked label {
      text-decoration: line-through;
      color: var(--text-muted);
    }

    /* ‚îÄ‚îÄ SUPPLIER CARD ‚îÄ‚îÄ */
    .supplier-section {
      margin-top: 20px;
      border-top: 1px solid var(--border);
      padding-top: 16px;
    }
    .supplier-section h4 { font-size: 13px; font-weight: 700; color: var(--primary); margin-bottom: 12px; }

    .supplier-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 10px; }

    .supplier-card {
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      transition: border-color 0.15s, box-shadow 0.15s;
      position: relative;
    }
    .supplier-card:hover { border-color: var(--accent); box-shadow: 0 2px 8px rgba(52,152,219,0.15); }
    .supplier-card.selected { border-color: var(--success); background: #f0faf5; }

    .supplier-selected-badge {
      position: absolute;
      top: 8px; right: 8px;
      background: var(--success);
      color: #fff;
      font-size: 10px;
      font-weight: 700;
      padding: 2px 7px;
      border-radius: 99px;
    }
    .supplier-card h5 { font-size: 12px; font-weight: 700; margin-bottom: 4px; padding-right: 50px; }
    .supplier-card .s-city { font-size: 11px; color: var(--text-muted); }
    .supplier-card .s-spec { font-size: 11px; color: var(--accent); margin-top: 6px; }
    .supplier-card .s-contact { font-size: 10px; color: var(--text-muted); margin-top: 4px; font-style: italic; }

    /* ‚îÄ‚îÄ SUPPLIER DIRECTORY ‚îÄ‚îÄ */
    .supplier-dir-grid {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .supplier-dir-comp {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .supplier-dir-comp-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: var(--primary);
      color: #fff;
    }
    .supplier-dir-comp-header .d-icon { font-size: 20px; }
    .supplier-dir-comp-header h3 { font-size: 15px; font-weight: 700; flex: 1; }
    .supplier-table {
      width: 100%;
      border-collapse: collapse;
    }
    .supplier-table th {
      background: #f4f6f9;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      padding: 10px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    .supplier-table td {
      padding: 12px 16px;
      font-size: 13px;
      border-bottom: 1px solid #f0f4f8;
      vertical-align: top;
    }
    .supplier-table tr:last-child td { border-bottom: none; }
    .supplier-table tr:hover td { background: #f9fafb; }
    .selected-row td { background: #f0faf5 !important; }
    .s-name-cell { font-weight: 600; }
    .s-check { color: var(--success); font-weight: 700; font-size: 16px; }

    /* ‚îÄ‚îÄ TIMELINE ‚îÄ‚îÄ */
    .timeline-table-wrap { overflow-x: auto; }
    .timeline-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 700px;
    }
    .timeline-table th {
      padding: 10px 12px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #fff;
      text-align: center;
    }
    .timeline-table th:first-child { text-align: left; background: var(--primary); }
    .th-design    { background: #8e44ad; }
    .th-rfq       { background: #2980b9; }
    .th-sample    { background: #d35400; }
    .th-prod      { background: #16a085; }
    .th-qc        { background: #c0392b; }
    .th-ship      { background: #27ae60; }

    .timeline-table td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
      text-align: center;
    }
    .timeline-table td:first-child { text-align: left; font-weight: 600; }
    .timeline-table tr:last-child td { border-bottom: none; }
    .timeline-table tr:hover td { background: #f9fafb; }

    .tl-cell {
      border-radius: 6px;
      padding: 5px 8px;
      font-size: 11px;
      font-weight: 700;
    }
    .tl-done    { background: #eafaf1; color: var(--success); }
    .tl-active  { background: #fef9e7; color: var(--warning); }
    .tl-todo    { background: #f4f6f9; color: var(--text-muted); }
    .tl-na      { color: #d0d5dd; }

    .tl-comp-name { display: flex; align-items: center; gap: 8px; }

    /* ‚îÄ‚îÄ UTILITIES ‚îÄ‚îÄ */
    .mt-4 { margin-top: 4px; }
    .mt-8 { margin-top: 8px; }
    .mt-16 { margin-top: 16px; }
    .text-muted { color: var(--text-muted); font-size: 12px; }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 6px;
      border: 1px solid transparent;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
    }
    .btn-outline {
      border-color: var(--border);
      background: #fff;
      color: var(--text);
    }
    .btn-outline:hover { border-color: var(--accent); color: var(--accent); }

    .btn-danger-outline {
      border-color: #fcdede;
      background: #fff;
      color: var(--danger);
      font-size: 12px;
      padding: 6px 12px;
    }
    .btn-danger-outline:hover { background: #fef0f0; }

    .actions-row {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
      margin-top: 12px;
    }

    .info-chip {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: #eef5ff;
      color: var(--accent);
      border-radius: 99px;
      padding: 4px 10px;
      font-size: 11px;
      font-weight: 600;
    }

    /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
    .empty { text-align: center; padding: 40px 20px; color: var(--text-muted); }
    .empty p { margin-top: 8px; font-size: 13px; }

    /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
    @media (max-width: 640px) {
      .stats-row { grid-template-columns: repeat(2, 1fr); }
      .header-top { padding: 16px; }
      .header-progress { padding: 10px 16px 0; }
      nav.tabs { padding: 0 16px; overflow-x: auto; }
      main { padding: 20px 14px; }
      .stage-pipeline { gap: 0; }
      .stage-label { font-size: 9px; }
    }

    /* ‚îÄ‚îÄ LOADING OVERLAY ‚îÄ‚îÄ */
    #loading-overlay {
      position: fixed;
      inset: 0;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      flex-direction: column;
      gap: 16px;
      transition: opacity 0.4s ease;
    }
    #loading-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .spinner {
      width: 40px; height: 40px;
      border: 3px solid rgba(255,255,255,0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ SYNC INDICATOR ‚îÄ‚îÄ */
    #sync-status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 5px 12px;
      border-radius: 99px;
      font-weight: 600;
      background: rgba(255,255,255,0.1);
      white-space: nowrap;
    }
    #sync-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: #27ae60;
      flex-shrink: 0;
    }
    #sync-status.syncing #sync-dot { background: var(--warning); animation: pulse 1s ease infinite; }
    #sync-status.offline #sync-dot { background: var(--danger); animation: none; }
    @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.3; } }

    /* ‚îÄ‚îÄ PRINT ‚îÄ‚îÄ */
    @media print {
      nav.tabs, .actions-row { display: none; }
      .tab-section { display: block !important; }
      .acc-body { display: block !important; }
      .task-list { display: block !important; }
    }
  </style>
</head>
<body>

<!-- ‚îÄ‚îÄ LOADING OVERLAY ‚îÄ‚îÄ -->
<div id="loading-overlay">
  <div style="color:#fff;font-size:20px;font-weight:800;letter-spacing:1px;">BABIPOLY</div>
  <div style="color:rgba(255,255,255,0.55);font-size:13px;">Connecting to database...</div>
  <div class="spinner"></div>
</div>

<header>
  <div class="header-top">
    <div class="header-brand">
      <div class="brand-icon">&#127922;</div>
      <div class="brand-text">
        <h1>BABIPOLY</h1>
        <p>Supply Chain Tracker &mdash; Production</p>
      </div>
    </div>
    <div class="header-stats">
      <div class="stat-pill">
        <div class="val" id="hdr-pct">0%</div>
        <div class="lbl">Overall Progress</div>
      </div>
      <div class="stat-pill">
        <div class="val" id="hdr-tasks">0/0</div>
        <div class="lbl">Tasks Completed</div>
      </div>
      <div class="stat-pill">
        <div class="val" id="hdr-comps">0/8</div>
        <div class="lbl">Active Components</div>
      </div>
      <div id="sync-status">
        <div id="sync-dot"></div>
        <span id="sync-label">Online</span>
      </div>
    </div>
  </div>
  <div class="header-progress">
    <div class="progress-bar-row">
      <span class="progress-label">Total Project Progress</span>
      <div class="progress-track">
        <div class="progress-fill" id="global-bar" style="width:0%"></div>
      </div>
      <span class="progress-pct" id="global-pct">0%</span>
    </div>
  </div>
</header>

<nav class="tabs" id="main-tabs">
  <button class="active" data-tab="overview">&#128202; Overview</button>
  <button data-tab="components">&#9881;&#65039; Components</button>
  <button data-tab="suppliers">&#127981; Suppliers</button>
  <button data-tab="timeline">&#128197; Timeline</button>
</nav>

<main>

  <!-- ‚ïê‚ïê TAB: OVERVIEW ‚ïê‚ïê -->
  <section class="tab-section active" id="tab-overview">
    <div class="stats-row" id="stats-row">
      <div class="stat-card s-total"><div class="num">8</div><div class="txt">Total Components</div></div>
      <div class="stat-card s-active"><div class="num" id="stat-active">0</div><div class="txt">In Progress</div></div>
      <div class="stat-card s-done"><div class="num" id="stat-done">0</div><div class="txt">Completed</div></div>
      <div class="stat-card s-tasks"><div class="num" id="stat-tasks">0%</div><div class="txt">Tasks Validated</div></div>
    </div>

    <div class="section-title">&#127775; Component Status</div>
    <div class="overview-grid" id="overview-grid"></div>
  </section>

  <!-- ‚ïê‚ïê TAB: COMPONENTS ‚ïê‚ïê -->
  <section class="tab-section" id="tab-components">
    <div class="section-title">&#9881;&#65039; Components &amp; Production Tasks</div>
    <div class="comp-accordion" id="comp-accordion"></div>
  </section>

  <!-- ‚ïê‚ïê TAB: SUPPLIERS ‚ïê‚ïê -->
  <section class="tab-section" id="tab-suppliers">
    <div class="section-title">&#127981; Supplier Directory (China)</div>
    <div class="supplier-dir-grid" id="supplier-dir"></div>
  </section>

  <!-- ‚ïê‚ïê TAB: TIMELINE ‚ïê‚ïê -->
  <section class="tab-section" id="tab-timeline">
    <div class="section-title">&#128197; Dashboard &mdash; Progress by Stage</div>
    <div class="timeline-table-wrap">
      <table class="timeline-table" id="timeline-table">
        <thead>
          <tr>
            <th style="width:200px">Component</th>
            <th class="th-design">Design</th>
            <th class="th-rfq">RFQ &amp; Quotes</th>
            <th class="th-sample">Prototype</th>
            <th class="th-prod">Production</th>
            <th class="th-qc">QC Inspection</th>
            <th class="th-ship">Shipping</th>
          </tr>
        </thead>
        <tbody id="timeline-body"></tbody>
      </table>
    </div>
    <p class="text-muted mt-16">
      <span class="tl-cell tl-done">&check; Completed</span>&nbsp;
      <span class="tl-cell tl-active">&#9654; In Progress</span>&nbsp;
      <span class="tl-cell tl-todo">&ndash; To Do</span>
    </p>
  </section>

</main>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const STAGES = [
  { id: 'design',     label: 'Design',       icon: '‚úèÔ∏è', color: '#8e44ad' },
  { id: 'rfq',        label: 'RFQ & Quotes', icon: 'üìã', color: '#2980b9' },
  { id: 'sample',     label: 'Prototype',    icon: 'üî¨', color: '#d35400' },
  { id: 'production', label: 'Production',   icon: 'üè≠', color: '#16a085' },
  { id: 'qc',         label: 'QC Inspection',icon: '‚úÖ', color: '#c0392b' },
  { id: 'shipping',   label: 'Shipping',     icon: 'üö¢', color: '#27ae60' },
];

const COMPONENTS = [
  {
    id: 'board',
    name: 'Game Board',
    nameEn: 'Game Board',
    icon: 'üó∫Ô∏è',
    specs: '500√ó500mm open ‚Äî 4-fold design (cross) ‚Äî 2mm greyboard ‚Äî matte laminate',
    category: 'print',
    suppliers: [
      {
        name: 'Dongguan Shenghua Printing Co., Ltd',
        city: 'Dongguan, Guangdong',
        specialty: 'Board game specialist, offset printing',
        contact: 'sales@shenghuaprinting.com',
        moq: '500 units',
      },
      {
        name: 'Guangzhou Raynna Paper Products Co., Ltd',
        city: 'Guangzhou, Guangdong',
        specialty: 'Custom board games & packaging',
        contact: 'info@raynnaprinting.com',
        moq: '300 units',
      },
      {
        name: 'Yancheng Wanlida Toy & Gift Co., Ltd',
        city: 'Yancheng, Jiangsu',
        specialty: 'Complete board game manufacturing',
        contact: 'wanlida@wanlida.cn',
        moq: '500 units',
      },
    ],
    stages: [
      {
        id: 'design',
        tasks: [
          'Finalize 500√ó500mm game board graphic design',
          'Prepare high-resolution PDF print files (CMYK, 300dpi)',
          'Validate 4-fold zones (cross structure)',
          'Send files for color proof',
          'Final design approval ‚Äî sign off',
        ],
      },
      {
        id: 'rfq',
        tasks: [
          'Send RFQ with full specs to 3+ printers',
          'Receive and compare quotes (FOB price, lead times)',
          'Negotiate price and payment terms',
          'Select final supplier',
          'Sign purchase order (PO)',
        ],
      },
      {
        id: 'sample',
        tasks: [
          'Order a pre-production print sample',
          'Receive physical prototype',
          'Test fold durability (no cracking)',
          'Check print quality and matte lamination',
          'Approve prototype (or request corrections)',
        ],
      },
      {
        id: 'production',
        tasks: [
          'Pay production deposit (30-50%)',
          'Confirm production launch',
          'Receive mid-production progress report',
          'Production complete ‚Äî receive factory notification',
        ],
      },
      {
        id: 'qc',
        tasks: [
          'Commission third-party QC inspection (e.g. QIMA, Bureau Veritas)',
          'Receive and analyze inspection report',
          'Verify: no cracks at board folds',
          'Verify: no lamination bubbles',
          'Approve shipment',
        ],
      },
      {
        id: 'shipping',
        tasks: [
          'Book freight forwarder / shipping agent',
          'Receive commercial invoice and packing list',
          'Confirm goods loading',
          'Track shipment (tracking number)',
          'Confirm delivery to destination warehouse',
        ],
      },
    ],
  },

  {
    id: 'cards',
    name: 'Playing Cards',
    nameEn: 'Playing Cards',
    icon: 'üÉè',
    specs: '60 cards (16 Chance + 16 Community Chest + 28 Property) ‚Äî 63√ó88mm ‚Äî 300gsm black core',
    category: 'print',
    suppliers: [
      {
        name: 'Wuhu Xinqi Printing & Packaging Co., Ltd',
        city: 'Wuhu, Anhui',
        specialty: 'Playing card specialist, black core, matte/glossy finish',
        contact: 'xinqi@xinqiprint.com',
        moq: '1000 sets',
      },
      {
        name: 'Shenzhen Goldensun Game & Gift Co., Ltd',
        city: 'Shenzhen, Guangdong',
        specialty: 'Custom playing cards & complete board games',
        contact: 'info@goldensungame.com',
        moq: '500 sets',
      },
      {
        name: 'Hangzhou Heyuan Card Industry Co., Ltd',
        city: 'Hangzhou, Zhejiang',
        specialty: 'Large format & standard playing cards, black core',
        contact: 'sales@heyuancard.com',
        moq: '1000 sets',
      },
    ],
    stages: [
      {
        id: 'design',
        tasks: [
          'Finalize artwork for all 3 card types (16 Chance + 16 Community + 28 Property)',
          'Prepare 63√ó88mm double-sided files with bleed (3mm bleed)',
          'Validate all French text on cards',
          'Send for color proof',
          'Final design approval',
        ],
      },
      {
        id: 'rfq',
        tasks: [
          'Send RFQ: 60 cards, 300gsm black core, matte finish, square corners',
          'Specify: double-sided CMYK printing',
          'Receive at least 3 quotes',
          'Verify "black core" spec (full opacity)',
          'Select supplier and send PO',
        ],
      },
      {
        id: 'sample',
        tasks: [
          'Order 1 complete sample set (60 cards)',
          'Check cut quality and square corners',
          'Test black core opacity (no transparency)',
          'Check matte finish and print quality',
          'Approve samples',
        ],
      },
      {
        id: 'production',
        tasks: [
          'Pay production deposit',
          'Launch production (60 cards √ó ordered quantity)',
          'Production follow-up ‚Äî factory report',
          'Production complete ‚Äî confirmed by factory',
        ],
      },
      {
        id: 'qc',
        tasks: [
          'Inspection: check clean cut and alignment',
          'Check black core opacity on each card type',
          'Count exact quantities (16+16+28 per set)',
          'Check uniform matte finish',
          'Approve shipment',
        ],
      },
      {
        id: 'shipping',
        tasks: [
          'Group shipment with other printed components',
          'Book freight forwarder',
          'Shipping documents ready',
          'Confirm loading',
          'Confirm delivery to warehouse',
        ],
      },
    ],
  },

  {
    id: 'money',
    name: 'Paper Money',
    nameEn: 'Paper Money',
    icon: 'üíµ',
    specs: '240 bills ‚Äî 4 denominations (1000F / 2000F / 5000F / 10000F) ‚Äî 155√ó65mm ‚Äî 80gsm offset',
    category: 'print',
    suppliers: [
      {
        name: 'Shenzhen Jinhao Printing Co., Ltd',
        city: 'Shenzhen, Guangdong',
        specialty: 'Specialized printing for game money & accessories',
        contact: 'sales@jinhaoprint.com',
        moq: '500 sets',
      },
      {
        name: 'Guangzhou Meijie Printing Co., Ltd',
        city: 'Guangzhou, Guangdong',
        specialty: 'Offset printing on colored paper, game bills',
        contact: 'meijie@meijieprint.com',
        moq: '1000 sets',
      },
      {
        name: 'Yiwu Xishu Paper Products Co., Ltd',
        city: 'Yiwu, Zhejiang',
        specialty: 'Board game money specialist',
        contact: 'xishu@xishupp.com',
        moq: '500 sets',
      },
    ],
    stages: [
      {
        id: 'design',
        tasks: [
          'Finalize artwork for 4 denominations (1000F, 2000F, 5000F, 10000F)',
          'Format 155√ó65mm ‚Äî single-sided print on colored paper',
          'Validate amounts, text and graphic elements',
          'Choose background colors for each denomination',
          'Final bill approval',
        ],
      },
      {
        id: 'rfq',
        tasks: [
          'Send RFQ: 240 bills, 4 denominations, 60 of each',
          'Specify 80gsm offset paper, colored background per denomination',
          'Request quotes for the 4 paper colors',
          'Receive at least 3 quotes',
          'Select supplier and send PO',
        ],
      },
      {
        id: 'sample',
        tasks: [
          'Order a sample of all 4 denominations',
          'Check background paper color for each denomination',
          'Verify readability of values and text',
          'Check cut quality (155√ó65mm)',
          'Approve samples',
        ],
      },
      {
        id: 'production',
        tasks: [
          'Pay deposit',
          'Launch production: 240 bills √ó ordered quantity',
          'Confirm denomination split (60√ó4)',
          'Production complete ‚Äî confirmed',
        ],
      },
      {
        id: 'qc',
        tasks: [
          'Verify exact quantities per denomination (60 √ó 4)',
          'Check print quality and background colors',
          'Verify dimensions 155√ó65mm',
          'Approve shipment',
        ],
      },
      {
        id: 'shipping',
        tasks: [
          'Group with other printed components',
          'Shipping documents ready',
          'Confirm loading',
          'Confirm delivery to warehouse',
        ],
      },
    ],
  },

  {
    id: 'pieces',
    name: 'Houses & Hotels',
    nameEn: 'Houses & Hotels',
    icon: 'üè†',
    specs: '30 green houses + 15 red hotels ‚Äî ABS plastic ‚Äî injection molded',
    category: 'plastic',
    suppliers: [
      {
        name: 'Dongguan Yisheng Plastic Products Co., Ltd',
        city: 'Dongguan, Guangdong',
        specialty: 'Injection molded ABS parts, board game accessories',
        contact: 'sales@yishengplastic.com',
        moq: '5000 pcs',
      },
      {
        name: 'Shenzhen Junye Plastic Industrial Co., Ltd',
        city: 'Shenzhen, Guangdong',
        specialty: 'Small colored plastic pieces for games',
        contact: 'junye@junyeplastic.com',
        moq: '3000 pcs',
      },
      {
        name: 'Guangdong Haicheng Plastic Industry Co., Ltd',
        city: 'Foshan, Guangdong',
        specialty: 'Small ABS plastic parts manufacturing',
        contact: 'info@haichengplastic.com',
        moq: '5000 pcs',
      },
    ],
    stages: [
      {
        id: 'design',
        tasks: [
          'Validate dimensions (standard Monopoly equivalent)',
          'Confirm that hotels are larger than houses',
          'Check if an existing standard mold can be used',
          'Finalize color spec (green / bright red)',
        ],
      },
      {
        id: 'rfq',
        tasks: [
          'Send RFQ: 30 green houses + 15 red hotels, ABS, injection molded',
          'Ask if existing mold is available (saves cost)',
          'Receive quotes with and without mold cost',
          'Select plastic parts supplier',
          'Send PO with precise color specifications',
        ],
      },
      {
        id: 'sample',
        tasks: [
          'Order house and hotel samples',
          'Check dimensions and ABS durability',
          'Test piece stability on the game board',
          'Check colors (green / red)',
          'Approve or request corrections',
        ],
      },
      {
        id: 'production',
        tasks: [
          'Pay production deposit',
          'Launch injection molding production',
          'Confirm: 30 houses √ó Q + 15 hotels √ó Q per batch',
          'Production complete ‚Äî confirmed',
        ],
      },
      {
        id: 'qc',
        tasks: [
          'Check for injection flash/burrs',
          'Verify color compliance (green / red)',
          'Count quantities (30 houses + 15 hotels per set)',
          'Check piece durability (no breakage)',
          'Approve shipment',
        ],
      },
      {
        id: 'shipping',
        tasks: [
          'Book freight forwarder (can be combined with tokens)',
          'Shipping documents ready',
          'Confirm loading',
          'Confirm delivery to warehouse',
        ],
      },
    ],
  },

  {
    id: 'tokens',
    name: 'Player Tokens',
    nameEn: 'Player Tokens',
    icon: 'üêò',
    specs: '8 elephant tokens ABS ‚Äî 20-25mm height ‚Äî 8 colors ‚Äî custom mold (Babipoly property)',
    category: 'plastic',
    suppliers: [
      {
        name: 'Dongguan Zhonghe Model Co., Ltd',
        city: 'Dongguan, Guangdong',
        specialty: 'Custom molds & plastic figurines for games',
        contact: 'sales@zhonghemold.com',
        moq: 'Mold + 1000 sets',
      },
      {
        name: 'Shenzhen Weilian Plastic Technology Co., Ltd',
        city: 'Shenzhen, Guangdong',
        specialty: 'Custom ABS mold design and manufacturing',
        contact: 'weilian@weilianplastic.com',
        moq: 'Mold + 500 sets',
      },
      {
        name: 'Guangzhou Kaka Toys Co., Ltd',
        city: 'Guangzhou, Guangdong',
        specialty: 'Custom game figurines and tokens',
        contact: 'kaka@kakatoys.com',
        moq: '1000 sets',
      },
    ],
    stages: [
      {
        id: 'design',
        tasks: [
          'Finalize 3D design of elephant token (20-25mm height)',
          'Create technical 3D file (STL / STEP) or dimensioned drawing',
          'Validate list of 8 ABS colors',
          'Confirm that the mold will be Babipoly property',
          'Final 3D design approval',
        ],
      },
      {
        id: 'rfq',
        tasks: [
          'Send RFQ with 3D file or technical drawing',
          'Request quote for custom mold + cost per token',
          'Confirm legal mold ownership (contractual clause)',
          'Receive at least 3 quotes',
          'Select mold manufacturer',
          'Sign contract including mold ownership clause',
        ],
      },
      {
        id: 'sample',
        tasks: [
          'Order T1 mold samples (first pass)',
          'Check shape and proportions of elephant token',
          'Test all 8 colors on samples',
          'Request corrections if necessary (T2, T3)',
          'Final mold approval ‚Äî Green Light for production',
        ],
      },
      {
        id: 'production',
        tasks: [
          'Pay production deposit',
          'Launch injection of 8 colors',
          'Confirm: 8 tokens per set (1 per color)',
          'Production complete ‚Äî confirmed',
        ],
      },
      {
        id: 'qc',
        tasks: [
          'Check for injection burrs on each token',
          'Verify exact 8 colors',
          'Count quantities per set (8 tokens √ó Q sets)',
          'Check size (20-25mm)',
          'Approve shipment',
        ],
      },
      {
        id: 'shipping',
        tasks: [
          'Book freight forwarder',
          'Documents with mold declaration (if shipped separately)',
          'Confirm loading',
          'Confirm delivery to warehouse',
        ],
      },
    ],
  },

  {
    id: 'dice',
    name: 'Dice',
    nameEn: 'Dice',
    icon: 'üé≤',
    specs: '2 dice ‚Äî 16mm ‚Äî white acrylic ‚Äî black pips',
    category: 'accessories',
    suppliers: [
      {
        name: 'Dongguan Kaika Acrylic Products Co., Ltd',
        city: 'Dongguan, Guangdong',
        specialty: 'Standard and custom acrylic dice',
        contact: 'kaika@kaikaacrylic.com',
        moq: '10,000 dice',
      },
      {
        name: 'Ningbo Zhixin Toys Co., Ltd',
        city: 'Ningbo, Zhejiang',
        specialty: 'Board game accessories: dice, chips, pieces',
        contact: 'sales@zhixintoys.com',
        moq: '5,000 dice',
      },
      {
        name: 'Yiwu Diangong Toy Co., Ltd',
        city: 'Yiwu, Zhejiang',
        specialty: 'Dice and game accessories ‚Äî volume manufacturer',
        contact: 'diangong@diangongtoy.com',
        moq: '5,000 dice',
      },
    ],
    stages: [
      {
        id: 'design',
        tasks: [
          'Confirm specs: 16mm, acrylic, white with black pips',
          'Validate that no custom design is required (standard)',
          'Confirm quantity: 2 dice per set √ó Q sets',
        ],
      },
      {
        id: 'rfq',
        tasks: [
          'Send RFQ: 16mm dice, white acrylic, black pips',
          'Ask to bundle with another supplier if possible',
          'Compare quotes (price per unit)',
          'Select supplier',
          'Send PO',
        ],
      },
      {
        id: 'sample',
        tasks: [
          'Order a sample of 16mm acrylic dice',
          'Test dice balance (random roll)',
          'Check sharpness of black pips',
          'Approve samples',
        ],
      },
      {
        id: 'production',
        tasks: [
          'Confirm order (2 dice √ó Q sets)',
          'Launch production',
          'Production complete ‚Äî confirmed',
        ],
      },
      {
        id: 'qc',
        tasks: [
          'Check pip clarity (1 to 6)',
          'Check acrylic quality (no bubbles)',
          'Count quantities (2 dice per set)',
          'Approve shipment',
        ],
      },
      {
        id: 'shipping',
        tasks: [
          'Group with other accessory components',
          'Shipping documents ready',
          'Confirm loading',
          'Confirm delivery to warehouse',
        ],
      },
    ],
  },

  {
    id: 'booklet',
    name: 'Instruction Booklet',
    nameEn: 'Instruction Booklet',
    icon: 'üìñ',
    specs: '4-page A5 (148√ó210mm) ‚Äî 157gsm art paper ‚Äî CMYK double-sided ‚Äî saddle-stitched',
    category: 'print',
    suppliers: [
      {
        name: 'Shenzhen Jinhao Printing Co., Ltd',
        city: 'Shenzhen, Guangdong',
        specialty: 'Brochures, booklets and quality printing',
        contact: 'sales@jinhaoprint.com',
        moq: '500 booklets',
      },
      {
        name: 'Guangzhou Artron Color Printing Co., Ltd',
        city: 'Guangzhou, Guangdong',
        specialty: 'High quality color printing, booklets and brochures',
        contact: 'artron@artronprint.com',
        moq: '1000 booklets',
      },
      {
        name: 'Dongguan Tuosite Printing Co., Ltd',
        city: 'Dongguan, Guangdong',
        specialty: 'Game booklets and presentation brochures',
        contact: 'sales@tuositeprint.com',
        moq: '500 booklets',
      },
    ],
    stages: [
      {
        id: 'design',
        tasks: [
          'Write complete Babipoly game rules',
          'Layout A5 (148√ó210mm), 4 pages (2 saddle-stitched sheets)',
          'Integrate illustrations and graphic design',
          'Final proofreading and rule validation by the team',
          'Final booklet approval',
        ],
      },
      {
        id: 'rfq',
        tasks: [
          'Send RFQ: A5 booklet, 4pp, 157gsm art paper, CMYK double-sided',
          'Specify: saddle stitch binding, matte finish',
          'Can be grouped with board supplier',
          'Receive at least 2 quotes',
          'Select supplier ‚Äî send PO',
        ],
      },
      {
        id: 'sample',
        tasks: [
          'Order a printed booklet sample',
          'Check text readability (font size, contrast)',
          'Check illustration quality',
          'Check saddle-stitch binding (secure)',
          'Approve sample',
        ],
      },
      {
        id: 'production',
        tasks: [
          'Pay deposit',
          'Launch booklet production',
          'Production complete ‚Äî confirmed',
        ],
      },
      {
        id: 'qc',
        tasks: [
          'Check saddle-stitch binding on a sample',
          'Check readability and color quality',
          'Count quantities',
          'Approve shipment',
        ],
      },
      {
        id: 'shipping',
        tasks: [
          'Group with printed components',
          'Shipping documents ready',
          'Confirm loading',
          'Confirm delivery to warehouse',
        ],
      },
    ],
  },

  {
    id: 'packaging',
    name: 'Game Box',
    nameEn: 'Game Box',
    icon: 'üì¶',
    specs: '270√ó270√ó60mm ‚Äî Rigid telescope box ‚Äî 2mm greyboard ‚Äî matte laminate ‚Äî thermoformed tray',
    category: 'print',
    suppliers: [
      {
        name: 'Shenzhen Yuto Packaging Technology Co., Ltd',
        city: 'Shenzhen, Guangdong',
        specialty: 'Premium rigid boxes, premium packaging',
        contact: 'sales@yutopackaging.com',
        moq: '500 units',
      },
      {
        name: 'Dongguan Xianglee Printing & Packaging Co., Ltd',
        city: 'Dongguan, Guangdong',
        specialty: 'Board game packaging: boxes + thermoformed trays',
        contact: 'xianglee@xiangleepack.com',
        moq: '300 units',
      },
      {
        name: 'Shanghai Birdview Packaging Co., Ltd',
        city: 'Shanghai',
        specialty: 'Premium rigid packaging, quality game boxes',
        contact: 'info@birdviewpack.com',
        moq: '500 units',
      },
    ],
    stages: [
      {
        id: 'design',
        tasks: [
          'Finalize artwork for box lid and base',
          'Format 270√ó270√ó60mm ‚Äî telescope box (lid & base)',
          'Design thermoformed tray (fitting all components)',
          'Include space for barcode (EAN)',
          'Final packaging design approval',
        ],
      },
      {
        id: 'rfq',
        tasks: [
          'Send RFQ: rigid telescope box 270√ó270√ó60mm, 2mm greyboard + 157gsm paper',
          'Specify: matte finish + shrink wrap + EAN barcode space',
          'Request separate quote for thermoformed tray',
          'Receive at least 3 quotes',
          'Select packaging manufacturer ‚Äî send PO',
        ],
      },
      {
        id: 'sample',
        tasks: [
          'Order a complete box mockup / sample',
          'Check structural strength (2mm greyboard)',
          'Test thermoformed tray with all physical components',
          'Check lid closure (telescope well fitted)',
          'Check matte lamination quality and printing',
          'Approve packaging sample',
        ],
      },
      {
        id: 'production',
        tasks: [
          'Pay deposit',
          'Launch production: boxes + thermoformed trays',
          'Receive mid-production progress report',
          'Production complete ‚Äî confirmed',
        ],
      },
      {
        id: 'qc',
        tasks: [
          'Check solid structure (no deformation)',
          'Verify: no lamination bubbles',
          'Test complete game assembly in box',
          'Check shrink wrap and presence of EAN space',
          'Approve shipment',
        ],
      },
      {
        id: 'shipping',
        tasks: [
          'Coordinate final assembly (all components in box)',
          'Book freight forwarder for final shipment',
          'Complete shipping documents ready',
          'Confirm loading of complete batch',
          'Confirm delivery to destination warehouse',
        ],
      },
    ],
  },
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE ‚Äî persisted in Firebase Realtime Database (see bottom of file)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// state shape:
// { board: { tasks: { design_0: true, ... }, supplier: 1 }, ... }
let state = {};

// saveState and the Firebase listener are defined at the bottom of the file
// after the Firebase SDK is loaded. This stub prevents errors during init.
function saveState() {}

function ensureComp(id) {
  if (!state[id]) state[id] = { tasks: {}, supplier: null };
  if (!state[id].tasks) state[id].tasks = {};
}

// ‚îÄ‚îÄ‚îÄ TASK KEY ‚îÄ‚îÄ‚îÄ
function taskKey(stageId, taskIdx) { return `${stageId}_${taskIdx}`; }

function isTaskDone(compId, stageId, taskIdx) {
  ensureComp(compId);
  return !!state[compId].tasks[taskKey(stageId, taskIdx)];
}

function toggleTask(compId, stageId, taskIdx) {
  ensureComp(compId);
  const k = taskKey(stageId, taskIdx);
  state[compId].tasks[k] = !state[compId].tasks[k];
  saveState();
  updateAll();
}

function setSupplier(compId, idx) {
  ensureComp(compId);
  state[compId].supplier = (state[compId].supplier === idx) ? null : idx;
  saveState();
  updateAll();
}

function resetComp(compId) {
  state[compId] = { tasks: {}, supplier: null };
  saveState();
  updateAll();
}

// ‚îÄ‚îÄ‚îÄ PROGRESS CALCULATIONS ‚îÄ‚îÄ‚îÄ
function compProgress(comp) {
  let total = 0, done = 0;
  comp.stages.forEach(st => {
    st.tasks.forEach((_, i) => {
      total++;
      if (isTaskDone(comp.id, st.id, i)) done++;
    });
  });
  return { total, done, pct: total ? Math.round((done / total) * 100) : 0 };
}

function stageProgress(comp, stageId) {
  const st = comp.stages.find(s => s.id === stageId);
  if (!st) return { total: 0, done: 0, pct: 0 };
  let total = st.tasks.length, done = 0;
  st.tasks.forEach((_, i) => { if (isTaskDone(comp.id, st.id, i)) done++; });
  return { total, done, pct: total ? Math.round((done / total) * 100) : 0 };
}

// stage status: 'done' | 'active' | 'todo'
function stageStatus(comp, stageId) {
  const { total, done } = stageProgress(comp, stageId);
  if (done === total && total > 0) return 'done';
  if (done > 0) return 'active';
  return 'todo';
}

// component status for card coloring
function compStatus(comp) {
  const { pct } = compProgress(comp);
  if (pct === 0) return 'todo';
  if (pct === 100) return 'done';
  return 'active';
}

// active stage (first incomplete one)
function activeStage(comp) {
  for (const st of comp.stages) {
    const { total, done } = stageProgress(comp, st.id);
    if (done < total) return st.id;
  }
  return comp.stages[comp.stages.length - 1].id; // all done
}

function globalProgress() {
  let total = 0, done = 0;
  COMPONENTS.forEach(c => {
    const p = compProgress(c);
    total += p.total;
    done += p.done;
  });
  return { total, done, pct: total ? Math.round((done / total) * 100) : 0 };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ
function updateHeader() {
  const { total, done, pct } = globalProgress();
  document.getElementById('global-bar').style.width = pct + '%';
  document.getElementById('global-pct').textContent = pct + '%';
  document.getElementById('hdr-pct').textContent = pct + '%';
  document.getElementById('hdr-tasks').textContent = `${done}/${total}`;

  let active = 0;
  COMPONENTS.forEach(c => { if (compStatus(c) === 'active') active++; });
  document.getElementById('hdr-comps').textContent = `${active}/8`;
}

// ‚îÄ‚îÄ‚îÄ STATS ROW ‚îÄ‚îÄ‚îÄ
function updateStats() {
  let nActive = 0, nDone = 0;
  COMPONENTS.forEach(c => {
    const s = compStatus(c);
    if (s === 'active') nActive++;
    if (s === 'done') nDone++;
  });
  const { pct } = globalProgress();
  document.getElementById('stat-active').textContent = nActive;
  document.getElementById('stat-done').textContent = nDone;
  document.getElementById('stat-tasks').textContent = pct + '%';
}

// ‚îÄ‚îÄ‚îÄ OVERVIEW GRID ‚îÄ‚îÄ‚îÄ
function renderOverviewGrid() {
  const grid = document.getElementById('overview-grid');
  grid.innerHTML = COMPONENTS.map(comp => {
    const { pct } = compProgress(comp);
    const status = compStatus(comp);
    const aStage = STAGES.find(s => s.id === activeStage(comp));
    const badgeClass = status === 'done' ? 'badge-done' : status === 'active' ? 'badge-active' : 'badge-todo';
    const badgeText = status === 'done' ? '‚úì Completed' : status === 'active' ? `‚Üó ${aStage.label}` : '‚Äî Not Started';
    return `
    <div class="comp-card status-${status}" onclick="switchToComp('${comp.id}')">
      <div class="comp-card-header">
        <div class="comp-icon">${comp.icon}</div>
        <div class="comp-card-header-text">
          <h3>${comp.name}</h3>
          <p>${comp.nameEn}</p>
        </div>
      </div>
      <div class="comp-card-progress">
        <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--text-muted)">
          <span>Progress</span><strong style="color:var(--text)">${pct}%</strong>
        </div>
        <div class="mini-track"><div class="mini-fill" style="width:${pct}%"></div></div>
      </div>
      <div class="comp-card-meta">
        <span class="text-muted">${comp.specs.split('‚Äî')[0].trim()}</span>
        <span class="stage-badge ${badgeClass}">${badgeText}</span>
      </div>
    </div>`;
  }).join('');
}

function switchToComp(compId) {
  // Switch to components tab and open that accordion
  switchTab('components');
  setTimeout(() => {
    const el = document.getElementById(`acc-${compId}`);
    if (el && !el.classList.contains('open')) {
      el.classList.add('open');
    }
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 50);
}

// ‚îÄ‚îÄ‚îÄ COMPONENT ACCORDION ‚îÄ‚îÄ‚îÄ
function renderAccordion() {
  const container = document.getElementById('comp-accordion');
  container.innerHTML = COMPONENTS.map(comp => {
    const { pct, done, total } = compProgress(comp);
    const status = compStatus(comp);
    const aStageId = activeStage(comp);
    return `
    <div class="acc-item" id="acc-${comp.id}">
      <div class="acc-header" onclick="toggleAcc('${comp.id}')">
        <div class="acc-icon">${comp.icon}</div>
        <div class="acc-title">
          <h3>${comp.name}</h3>
          <p>${comp.specs}</p>
        </div>
        <div class="acc-meta">
          <span class="stage-badge ${status === 'done' ? 'badge-done' : status === 'active' ? 'badge-active' : 'badge-todo'}">
            ${status === 'done' ? '‚úì Completed' : status === 'active' ? '‚Üó In Progress' : '‚Äî Not Started'}
          </span>
          <div class="acc-pct">${pct}%</div>
          <div class="acc-chevron">‚ñæ</div>
        </div>
      </div>
      <div class="acc-progress-bar">
        <div class="acc-progress-fill" style="width:${pct}%"></div>
      </div>
      <div class="acc-body">
        ${renderPipeline(comp, aStageId)}
        ${renderTaskSections(comp)}
        ${renderSupplierPicker(comp)}
        <div class="actions-row">
          <button class="btn btn-danger-outline" onclick="if(confirm('Reset ${comp.name}?')) resetComp('${comp.id}')">
            ‚úï Reset
          </button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function toggleAcc(compId) {
  const el = document.getElementById(`acc-${compId}`);
  if (el) el.classList.toggle('open');
}

function renderPipeline(comp, activeStageId) {
  return `<div class="stage-pipeline">
    ${STAGES.map(st => {
      const status = stageStatus(comp, st.id);
      const { done, total } = stageProgress(comp, st.id);
      const dot = status === 'done' ? '‚úì' : status === 'active' ? '‚ñ∂' : st.icon;
      return `
      <div class="stage-step ${status}">
        <div class="stage-dot">${dot}</div>
        <div class="stage-label">${st.label}<br><span style="font-size:9px;opacity:0.8">${done}/${total}</span></div>
      </div>`;
    }).join('')}
  </div>`;
}

function renderTaskSections(comp) {
  return `<div class="tasks-grid">
    ${comp.stages.map(st => {
      const stage = STAGES.find(s => s.id === st.id);
      const { done, total } = stageProgress(comp, st.id);
      const status = stageStatus(comp, st.id);
      const dotColor = status === 'done' ? 'var(--success)' : status === 'active' ? 'var(--warning)' : 'var(--border)';
      const isOpen = status === 'active' ? ' open' : '';
      return `
      <div class="task-stage-block${isOpen}" id="tsb-${comp.id}-${st.id}">
        <div class="task-stage-header" onclick="toggleTaskStage('${comp.id}','${st.id}')">
          <div class="task-stage-dot" style="background:${dotColor}"></div>
          <h4>${stage.icon} ${stage.label}</h4>
          <span class="task-stage-count">${done}/${total} tasks</span>
          <span class="task-stage-chevron">‚ñæ</span>
        </div>
        <div class="task-list">
          ${st.tasks.map((task, i) => {
            const checked = isTaskDone(comp.id, st.id, i);
            return `
            <div class="task-item ${checked ? 'checked' : ''}" id="ti-${comp.id}-${st.id}-${i}">
              <input type="checkbox" id="cb-${comp.id}-${st.id}-${i}"
                ${checked ? 'checked' : ''}
                onchange="toggleTask('${comp.id}','${st.id}',${i})">
              <label for="cb-${comp.id}-${st.id}-${i}">${task}</label>
            </div>`;
          }).join('')}
        </div>
      </div>`;
    }).join('')}
  </div>`;
}

function toggleTaskStage(compId, stageId) {
  const el = document.getElementById(`tsb-${compId}-${stageId}`);
  if (el) el.classList.toggle('open');
}

function renderSupplierPicker(comp) {
  ensureComp(comp.id);
  const selected = state[comp.id].supplier;
  return `
  <div class="supplier-section">
    <h4>üè≠ Recommended Suppliers (China) &mdash; select the chosen supplier:</h4>
    <div class="supplier-cards">
      ${comp.suppliers.map((s, i) => `
      <div class="supplier-card ${selected === i ? 'selected' : ''}"
           onclick="setSupplier('${comp.id}', ${i})">
        ${selected === i ? '<span class="supplier-selected-badge">‚úì Selected</span>' : ''}
        <h5>${s.name}</h5>
        <div class="s-city">üìç ${s.city}</div>
        <div class="s-spec">${s.specialty}</div>
        <div class="s-contact">‚úâ ${s.contact} &nbsp;|&nbsp; MOQ: ${s.moq}</div>
      </div>`).join('')}
    </div>
  </div>`;
}

// ‚îÄ‚îÄ‚îÄ SUPPLIER DIRECTORY ‚îÄ‚îÄ‚îÄ
function renderSupplierDir() {
  const dir = document.getElementById('supplier-dir');
  dir.innerHTML = COMPONENTS.map(comp => {
    ensureComp(comp.id);
    const selectedIdx = state[comp.id].supplier;
    return `
    <div class="supplier-dir-comp">
      <div class="supplier-dir-comp-header">
        <span class="d-icon">${comp.icon}</span>
        <h3>${comp.name} <span style="opacity:0.6;font-weight:400;font-size:13px">(${comp.nameEn})</span></h3>
        ${selectedIdx !== null ? `<span class="info-chip">‚úì Supplier selected</span>` : ''}
      </div>
      <table class="supplier-table">
        <thead>
          <tr>
            <th>Supplier</th>
            <th>City / Province</th>
            <th>Specialty</th>
            <th>Contact</th>
            <th>MOQ</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          ${comp.suppliers.map((s, i) => `
          <tr class="${selectedIdx === i ? 'selected-row' : ''}">
            <td class="s-name-cell">${s.name}</td>
            <td>${s.city}</td>
            <td style="color:var(--accent-dark)">${s.specialty}</td>
            <td style="font-size:12px">${s.contact}</td>
            <td>${s.moq}</td>
            <td>${selectedIdx === i ? '<span class="s-check">‚úì Selected</span>' : '<span style="color:#ccc">‚Äî</span>'}</td>
          </tr>`).join('')}
        </tbody>
      </table>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ‚îÄ TIMELINE ‚îÄ‚îÄ‚îÄ
function renderTimeline() {
  const tbody = document.getElementById('timeline-body');
  tbody.innerHTML = COMPONENTS.map(comp => {
    return `<tr>
      <td><div class="tl-comp-name">${comp.icon} ${comp.name}</div></td>
      ${STAGES.map(st => {
        const status = stageStatus(comp, st.id);
        const { done, total } = stageProgress(comp, st.id);
        let cls = 'tl-todo', txt = '‚Äî';
        if (status === 'done')   { cls = 'tl-done';   txt = `‚úì ${done}/${total}`; }
        if (status === 'active') { cls = 'tl-active';  txt = `‚ñ∂ ${done}/${total}`; }
        // tl-todo stays as '‚Äî'
        return `<td><span class="tl-cell ${cls}">${txt}</span></td>`;
      }).join('')}
    </tr>`;
  }).join('');
}

// ‚îÄ‚îÄ‚îÄ MASTER UPDATE ‚îÄ‚îÄ‚îÄ
function updateAll() {
  updateHeader();
  updateStats();

  // Patch overview cards (no full re-render to avoid flicker)
  renderOverviewGrid();

  // Patch accordion items ‚Äî update progress bars, badges, pipelines, tasks in place
  COMPONENTS.forEach(comp => {
    const accEl = document.getElementById(`acc-${comp.id}`);
    if (!accEl) return;
    // Just re-render body content if open
    const body = accEl.querySelector('.acc-body');
    if (body) {
      const { pct } = compProgress(comp);
      const status = compStatus(comp);
      const aStageId = activeStage(comp);
      // update progress bar
      const bar = accEl.querySelector('.acc-progress-fill');
      if (bar) bar.style.width = pct + '%';
      // update pct text
      const pctEl = accEl.querySelector('.acc-pct');
      if (pctEl) pctEl.textContent = pct + '%';
      // update badge
      const badge = accEl.querySelector('.acc-meta .stage-badge');
      if (badge) {
        badge.className = `stage-badge ${status === 'done' ? 'badge-done' : status === 'active' ? 'badge-active' : 'badge-todo'}`;
        badge.textContent = status === 'done' ? '‚úì Completed' : status === 'active' ? '‚Üó In Progress' : '‚Äî Not Started';
      }
      // update individual checkboxes and task items
      comp.stages.forEach(st => {
        st.tasks.forEach((_, i) => {
          const cb = document.getElementById(`cb-${comp.id}-${st.id}-${i}`);
          if (cb) cb.checked = isTaskDone(comp.id, st.id, i);
          const ti = document.getElementById(`ti-${comp.id}-${st.id}-${i}`);
          if (ti) ti.className = `task-item ${isTaskDone(comp.id, st.id, i) ? 'checked' : ''}`;
        });
        // update stage task count
        const { done, total } = stageProgress(comp, st.id);
        const tsb = document.getElementById(`tsb-${comp.id}-${st.id}`);
        if (tsb) {
          const cnt = tsb.querySelector('.task-stage-count');
          if (cnt) cnt.textContent = `${done}/${total} tasks`;
          const dot = tsb.querySelector('.task-stage-dot');
          if (dot) {
            const sstatus = stageStatus(comp, st.id);
            dot.style.background = sstatus === 'done' ? 'var(--success)' : sstatus === 'active' ? 'var(--warning)' : 'var(--border)';
          }
        }
      });
      // update supplier picker
      const sp = body.querySelector('.supplier-section');
      if (sp) sp.outerHTML = renderSupplierPicker(comp);
    }
  });

  // Timeline
  renderTimeline();
  // Supplier dir
  renderSupplierDir();
}

// ‚îÄ‚îÄ‚îÄ FULL INITIAL RENDER ‚îÄ‚îÄ‚îÄ
function fullRender() {
  updateHeader();
  updateStats();
  renderOverviewGrid();
  renderAccordion();
  renderSupplierDir();
  renderTimeline();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function switchTab(tabId) {
  document.querySelectorAll('.tab-section').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('#main-tabs button').forEach(btn => btn.classList.remove('active'));
  const section = document.getElementById(`tab-${tabId}`);
  if (section) section.classList.add('active');
  const btn = document.querySelector(`#main-tabs button[data-tab="${tabId}"]`);
  if (btn) btn.classList.add('active');
}

document.getElementById('main-tabs').addEventListener('click', e => {
  const btn = e.target.closest('button[data-tab]');
  if (btn) switchTab(btn.dataset.tab);
});

// fullRender() is called by the Firebase real-time listener once data loads.
</script>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// ‚îÄ‚îÄ FIREBASE INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const firebaseConfig = {
  apiKey: "AIzaSyAHITJvSBgKrNYn9Cf3UvBflKbT0AgqPdQ",
  authDomain: "supplychain-8269c.firebaseapp.com",
  databaseURL: "https://supplychain-8269c-default-rtdb.firebaseio.com",
  projectId: "supplychain-8269c",
  storageBucket: "supplychain-8269c.firebasestorage.app",
  messagingSenderId: "629685851701",
  appId: "1:629685851701:web:0f8488620d800f841cc37c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const stateRef = db.ref('babipoly_sc_v2');

// ‚îÄ‚îÄ SYNC STATUS UI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setSyncStatus(mode, label) {
  const el = document.getElementById('sync-status');
  const lbl = document.getElementById('sync-label');
  if (el)  { el.className = ''; el.classList.add(mode); }
  if (lbl) lbl.textContent = label;
}

db.ref('.info/connected').on('value', snap => {
  if (snap.val()) {
    setSyncStatus('online', 'Online');
  } else {
    setSyncStatus('offline', 'Offline');
  }
});

// ‚îÄ‚îÄ DEBOUNCED SAVE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _saveTimer = null;
function saveState() {
  setSyncStatus('syncing', 'Sync...');
  clearTimeout(_saveTimer);
  _saveTimer = setTimeout(() => {
    stateRef.set(state)
      .then(() => setSyncStatus('online', 'Online'))
      .catch(() => setSyncStatus('offline', 'Error'));
  }, 400);
}

// ‚îÄ‚îÄ REAL-TIME LISTENER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _firstLoad = true;
stateRef.on('value', snapshot => {
  state = snapshot.val() || {};

  if (_firstLoad) {
    _firstLoad = false;
    // Migrate any existing localStorage data if Firebase is empty
    if (Object.keys(state).length === 0) {
      try {
        const local = localStorage.getItem('babipoly_sc_v2');
        if (local) {
          state = JSON.parse(local);
          stateRef.set(state); // push local data up to Firebase
        }
      } catch (e) {}
    }
    // Hide loading overlay
    const overlay = document.getElementById('loading-overlay');
    if (overlay) {
      overlay.classList.add('hidden');
      setTimeout(() => overlay.remove(), 450);
    }
    fullRender();
  } else {
    // Remote update from another device ‚Äî re-render
    updateAll();
  }
});
</script>
</body>
</html>
